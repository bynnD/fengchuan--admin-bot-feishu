# 20260222自有工单创新版 - 代码状态快照

**版本名称**: 20260222自有工单创新版  
**记录时间**: 2026-02-22

## 主要功能

- 采购申请、用印申请、开票申请、外出报备的审批工单自动创建
- 飞书内部自建工单均可正常处理
- **使用引导优化**：意图不明/空消息/纯图片时，展示使用简要说明及各类型例句，减少对话轮数
- 用印申请：从文件内容（Word/PDF/图片/扫描件）自动识别用印公司、印章类型、用印事由
- 开票申请：上传结算单+合同，AI 自动识别金额、购方名称、税号等，支持「客户/开票名称」「税务登记证号/社会统一信用代码」等表单字段映射
- 采购申请：采购类别根据物品自动推断，物资明细解析
- 文件上传：飞书 OCR 支持图片和扫描件
- 查看工单：使用飞书官方 `client/mini_program/open` applink，在应用内打开审批详情

## 使用引导例句（APPROVAL_USAGE_GUIDE）

| 类型 | 例句 |
|------|------|
| 用印申请 | 帮我盖这份合同的公章，律师已审核是 |
| 开票申请 | 我要开增值税发票，发票内容是技术服务费 |
| 采购申请 | 采购一台笔记本 ThinkPad X1 8000元，下周一到货 |
| 外出报备 | 我2月24日9点要外出2个小时，去税务局办理税务变更 |

## 关键文件

- `main.py` - 主逻辑、消息处理、卡片发送、开票申请流程、`_get_usage_guide_message`
- `approval_types/__init__.py` - `APPROVAL_USAGE_GUIDE` 配置
- `approval_types/invoice.py` - 开票申请，含 `extract_fields_from_file`、`FIELD_NAME_ALIASES`
- `approval_types/seal.py` - 用印申请
- `approval_types/purchase.py` - 采购申请
- `field_cache.py` - 表单字段缓存

## 创建标签（可选）

```bash
git add -A && git commit -m "20260222自有工单创新版" && git tag -a 20260222自有工单创新版 -m "20260222自有工单创新版: 使用引导+例句优化"
```
